var t="from"in Array;function e(e){if(t)return Array.from(e);for(var r=e.length,n=Array(r),o=0;o<r;o++)n[o]=e[o];return n}var r="create"in Object?Object.create(null):{};function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t,e,r){return(i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&o(i,r.prototype),i}).apply(null,arguments)}function s(t){var e="function"==typeof Map?new Map:void 0;return(s=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return i(t,arguments,n(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),o(r,t)})(t)}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,r,n,o){var i=e(t.children),s=Array.isArray(i),a=0;for(i=s?i:i[Symbol.iterator]();;){var u;if(s){if(a>=i.length)break;u=i[a++]}else{if((a=i.next()).done)break;u=a.value}var p=u;p.customElement=o;var h=p.dataset,f=function(i){var s=r[h[i]];if("o"===(i="class"===i?"className":i)[0]&&"n"===i[1]){var a;if(s=s.bind(p),p.hasAttribute("updates-reactively")){if(n)return d=i,"continue";a=function(){var n=e(arguments);s.apply(null,n),c(t,r,!0,o)}}else a=s;var u=i.substr(2);p._events||(p._events={}),p._events[u]||p.addEventListener(u,l),p._events[u]=a}else p[i]=s;d=i};for(var d in h)f(d);c(p,r,!1,o)}}function l(t){this._events[t.type](t)}var u=function(t,e,r){void 0===r&&(r=e),Object.defineProperty(t,r,{enumerable:!0,get:function(){var t=this.getAttribute(e);return null===t?"":t},set:function(t){this.setAttribute(e,t)}})},p=function(t,e,r){void 0===r&&(r=e),Object.defineProperty(t,r,{enumerable:!0,get:function(){return this.hasAttribute(e)},set:function(t){t?this.setAttribute(e,""):this.removeAttribute(e)}})},h=function(){if("undefined"!=typeof globalThis)return globalThis;Object.defineProperty(Object.prototype,"__this",{enumerable:!0,configurable:!0,get:function(){return this}});var t=__this;return delete Object.prototype.__this,t}();function f(t,e,r){var n=t.getAttribute("custom-element"),o=function(e){var o,i;function s(){var o;return(o=e.call(this)||this).s=o.attachShadow({mode:"open"}),o.s.appendChild(t.content.cloneNode(!0)),o.config=Object.assign({},n in r?r[n]:r),c(o.s,o.config,!1,a(o)),o.update=function(){return c(o.s,o.config,!0,a(o))},o}return i=e,(o=s).prototype=Object.create(i.prototype),o.prototype.constructor=o,o.__proto__=i,s}(s(HTMLElement)),i=e.modifyConstructor,l=e.modifyPrototype,f=e.observedAttributes,d=o.prototype;i&&i(o),l&&l(d),f&&function(t,e,r){var n={},o=[];Object.defineProperty(r,"attributeChangedCallback",{value:function(t,e,r){var n=this.__attrListeners[t];return n&&n.call(this,e,r)}});var i=t,s=Array.isArray(i),a=0;for(i=s?i:i[Symbol.iterator]();;){var c;if(s){if(a>=i.length)break;c=i[a++]}else{if((a=i.next()).done)break;c=a.value}var l=c,h=l.type,f=l.prop;n[f]=l.listener,o.push(f),"string"==typeof l||null==h||"string"===h?u(r,f):"bool"===h&&p(r,f)}e.observedAttributes=o,Object.defineProperty(r,"__attrListeners",{value:n})}(f,o,d),h.customElements.define(n,o)}var d=function(t,n,o){t=t||{};var i=o?Array.isArray(o)?o:[o]:e(document.querySelectorAll("template[is='custom']")),s=Array.isArray(i),a=0;for(i=s?i:i[Symbol.iterator]();;){var c;if(s){if(a>=i.length)break;c=i[a++]}else{if((a=i.next()).done)break;c=a.value}f(c,t[c.getAttribute("custom-element")]||r,n||r)}};const b=(t,e)=>{const r=document.createElement("template");return r.setAttribute("is","custom"),r.setAttribute("custom-element",t),r.innerHTML=e||"",r},m=new RegExp("{{data}}","g"),v=(t,e)=>"string"==typeof t?t.replace(m,e):t,y=(t,e)=>{if("object"!=typeof(t=v(t,e)))return document.createTextNode(t);let{el:r,attrs:n,children:o}=t;!Array.isArray(o)&&(o=[o]);const i=document.createElement(r);for(let t of Object.keys(n||{})){t=v(t,e);let r=n[t];r=v(r,e),"o"===t[0]&&"n"===t[1]?i.addEventListener(t.substr(2),r):i.setAttribute(t,r)}for(const t of o||[])i.appendChild(y(t,e));return i},_=t=>"string"==typeof t?JSON.parse(t):t,g=()=>d({"dom-repeat":{observedAttributes:[{prop:"domfor",listener(t,e){if(t==e)return;let r;t&&(t=>{for(let e;e=t.lastChild;)t.removeChild(e)})(this.shadowRoot);const n=(e=_(e)).tree.el;r="Fragment"===n||null==n?document.createDocumentFragment():document.createElement(n);const o=e.tree.child;for(const t of _(e.loop)){const e=y(o,t);r.appendChild(e)}this.s.appendChild(r)}}]}},{},b("dom-repeat")),P=(document.querySelector("base")||{}).href,w=(t,e)=>{const r=t.base||P;return e?new URL(r||"/",location.href).pathname:r};function A(t){const e=w(t);let r=window.location.pathname;return e&&(r=new URL(r.replace(new URL(e,location.href).pathname,""),location.href).pathname),r=r.replace(/^\//,""),r||"/"}const O=()=>d({"dom-link":{modifyPrototype(t){Object.defineProperties(t,{__oc:{value(t){this.a.href&&(t.preventDefault(),window.history.pushState(0,0,function(...t){return(t=t.map((e,r)=>(r&&(e=e.replace(new RegExp("^/"),"")),r!==t.length-1&&(e=e.replace(new RegExp("/$"),"")),e))).join("/")}(w(this,!0),new URL(this.a.href).pathname)),dispatchEvent(new Event("dom-router-on-link-click")))}},disconnectedCallback:{value(){this.a.removeEventListener(this._oc)}},connectedCallback:{value(){let t;for(this._oc=this.__oc.bind(this),this.a=this.s.getElementById("dom-link"),this.a.addEventListener("click",this._oc);t=(this._pendingProps||[]).pop();)this.a[t[0]]=t[1]}},attributeChangedCallback:{value(t,e,r){if(this.a)this.a[t]=r;else{const e=this._pendingProps||[];this._pendingProps=e,e.push([t,r])}}}})},modifyConstructor(t){t.observedAttributes=["target","download","ping","rel","relList","hreflang","type","referrerPolicy","text","coords","charset","name","rev","shape","href","origin","protocol","username","password","host","hostname","port","pathname","search","hash","style"]}},"dom-router":{modifyPrototype(t){Object.defineProperties(t,{paths:{get(){return this._paths},set(t){this._paths!==t&&(this._paths=t,this.setAttribute("path-data",Object.keys(t).join(", ")),this._onPop())}},__onPop:{value(){const t=A(this);if(t===this.current)return;const e=this._paths[t];this.current=t,function(t,e,r){(t=>{for(let e;e=t.lastChild;)t.removeChild(e)})(t),"function"==typeof e&&(e=e(A(r))),t.appendChild(e)}(this.s,e,this)}},connectedCallback:{value(){this._onPop=this.__onPop.bind(this),window.addEventListener("dom-router-on-link-click",this._onPop),window.addEventListener("popstate",this._onPop)}},disconnectedCallback:{value(){window.removeEventListener("dom-router-on-link-click",this._onPop),window.removeEventListener("popstate",this._onPop)}}})},observedAttributes:[{prop:"base"}]}},{},[b("dom-router"),b("dom-link","<a id='dom-link'><slot></slot></a>")]),j=b("cache-script"),k={modifyPrototype(t){Object.defineProperties(t,{_load:{value(t,e){let r=!1;return this._corsSafe.includes(t.host)&&(r=!0),function(t){Promise.resolve(t).then(t=>document.head.appendChild(Object.assign(document.createElement("script"),t)))}(r?E(e):{src:e})}},connectedCallback:{value(){this._corsSafe=[location.host];const t=this._pendingProps;t&&this._load(t.abs,t.url),this._pendingProps=null}}})},observedAttributes:[{prop:"cors-safe-origins",listener(t,e){this._corsSafe=(this._corsSafe||[]).concat(e.split(","))}},{prop:"src",listener(t,e){const r=new URL(e,location.href),n=r.toString();if(t!==n&&t!==e)return this._corsSafe?void this._load(r,n):this._pendingProps={abs:r,url:n}}}]},E="caches"in self?t=>new Promise(e=>caches.open("js").then(r=>r.match(t).then(n=>{n?n.text().then(t=>e({text:t})):fetch(t).then(n=>{const o=n.clone();r.put(t,o),n.text().then(t=>e({text:t}))})}))):t=>new Promise(e=>fetch(t).then(t=>t.text()).then(t=>e({text:t})));var C=()=>d({"cache-script":k},{},j);export{C as cacheScript,g as domRepeat,O as domRouter};
//# sourceMappingURL=index.modern.js.map
